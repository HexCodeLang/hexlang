<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HexLang: Live Spellcasting</title>
  <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
  <script defer src="https://pyscript.net/latest/pyscript.js"></script>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: 'Courier New', monospace;
      padding: 2em;
    }
    textarea {
      width: 100%;
      height: 200px;
      background: #222;
      color: #0f0;
      border: none;
      padding: 1em;
      font-size: 1em;
    }
    button {
      margin-top: 1em;
      padding: 0.5em 1em;
      font-size: 1em;
      background: #333;
      color: #fff;
      border: 1px solid #666;
      cursor: pointer;
    }
    pre {
      background: #000;
      padding: 1em;
      color: #0f0;
      min-height: 100px;
    }
  </style>
</head>
<body>

  <h1>🧪 HexLang Live Demo</h1>
  <p>Write your ritual below and cast it into the void:</p>

  <textarea id="spell">
conjure mana to 90
bind fury from mana + 10
whisper "Charging..."
if fury exceeds 95 then whisper "Spell cast!"
  </textarea>
  <br>
  <button onclick="castSpell()">CAST SPELL</button>

  <h2>🖥 Output</h2>
  <pre id="output"></pre>

  <py-script id="hex-interpreter">
from pyodide.ffi import to_js

variables = {}

def evaluate(expr):
    try:
        return eval(expr, {}, variables)
    except:
        return expr.strip('"')

def run_hexlang(lines):
    output = []
    for line in lines:
        line = line.strip()
        if not line or line.startswith("#"):
            continue
        if line.startswith("conjure "):
            try:
                _, var, _, value = line.split()
                variables[var] = evaluate(value)
            except:
                output.append(f"✖️ Error conjuring: {line}")
        elif line.startswith("bind "):
            parts = line.split()
            var = parts[1]
            expr = ' '.join(parts[3:])
            variables[var] = evaluate(expr)
        elif line.startswith("whisper "):
            msg = line[8:]
            val = evaluate(msg)
            output.append(str(val))
        elif line.startswith("if "):
            parts = line.split()
            var = parts[1]
            comp = parts[2]
            val = int(parts[3])
            if comp == "exceeds" and variables.get(var, 0) > val:
                if "whisper" in line:
                    message = line.split("whisper", 1)[1].strip().strip('"')
                    output.append(message)
    return output

def cast(spell_code):
    lines = spell_code.strip().split('\n')
    result = run_hexlang(lines)
    js_out = Element("output")
    js_out.write('\n'.join(result))

  </py-script>

  <script>
    function castSpell() {
      const code = document.getElementById("spell").value;
      pyodide.runPython(`
cast("""${code.replace(/\\/g, '\\\\').replace(/`/g, '\\`').replace(/"/g, '\\"').replace(/\n/g, '\\n')}""")
      `);
    }
  </script>

</body>
</html>
